#!/bin/bash

lib=$(dirname $0)/../../lib/em.shlib; [ -f ${lib} ] && . ${lib} || { echo "${lib} not found" 1>&2; exit 1; }
lib=$(dirname $0)/lib/$(basename $0).shlib; [ -f ${lib} ] && . ${lib}

function usage()
{
cat <<EOF

Starts the specified instance.

Usage:

    $(basename $0) <instance-name>

Currently, the instances can be only started one at a time (TODO).

EOF
exit 0
}

function main()
{
    process-common-arguments $@

    debug "$(basename $0) command line arguments: $@"

    ${help} && usage;

    local name
    for i in ${args}; do
        [ "${name}" = "" ] && name=${i} || fail "currently we only support starting one instance at a time"
    done

    [ "${name}" = "" ] && fail "instance name not specified"

    local id=$(ec2-describe-instances | jw ec2.ec2_describe_instances_parser --filter name=${name} --list id) || { exit 1; }

    [ "${id}" = "" ] && exit 1

    info "starting ${id} ..."

    ec2-start-instances ${id} || fail "failed to start"

}

main $@


