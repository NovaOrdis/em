#!/bin/bash


function main()
{
    [ ! -h $0 ] && { echo "$0 is not supposed to be used via a symbolic link, not directly" 1>&2; exit 1; }

    # we're a link
    local link_target
    link_target=$(readlink $0) || exit 1
    link_target_dir=$(dirname ${link_target})
    [ -f ${link_target_dir}/ec2.shlib ] && . ${link_target_dir}/ec2.shlib || { echo "${link_target_dir}/ec2.shlib not found" 1>&2; exit 1; }
    name=$(basename $0)

    local ip
    ip=$(ip_from_etc_hosts ${name}) || exit 1
    [ "${ip}" = "" ] && fail "no IP address associated with ${name} in /etc/hosts"
    ssh ec2-user@${ip}
}

main