#!/bin/bash

[ -f $(dirname $0)/ec2.shlib ] && . $(dirname $0)/ec2.shlib || { echo "$(dirname $0)/ec2.shlib not found" 1>&2; exit 1; }

function display_help()
{
cat <<EOF

The script queries the current Amazon EC2 region \$EC2_URL (${EC2_URL})
with ec2-describe-instances and pulls the current public IP addresses associated running
instances.

Usage:

    TODO

EOF
}

function main()
{
    process_common_options $@

    local name_and_public_ip_for_running_instances;

    name_and_public_ip_for_running_instances=$(ec2-describe-instances | $(dirname $0)/em-java-launcher ${debug_arg} Ec2DescribeInstancesParser --filter state=running --list name:public-ip) || { exit 1; }

    debug "name_and_public_ip_for_running_instances: ${name_and_public_ip_for_running_instances}"

    if [ "${name_and_public_ip_for_running_instances}" = "" ]; then
        info "no running hosts"
    else
        update_etc_hosts "${name_and_public_ip_for_running_instances}"
    fi
}

main $@